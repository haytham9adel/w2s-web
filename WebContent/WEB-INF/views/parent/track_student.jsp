<jsp:include page="header.jsp" />
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>
<%@ page import="resources.Assets"%>
<style>

#markerLayer img {
    border-radius: 50% !important;
    	
    padding: 10px !important;
    background-position: 2px 7px !important;
    background-repeat: no-repeat;
}


</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<!-- <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&key=AIzaSyC7CzVRaX4toLFXcXnNV_8TUtgRy2Y0efE"></script> -->
<script src="https://maps.googleapis.com/maps/api/js?libraries=geometry&key=AIzaSyC7CzVRaX4toLFXcXnNV_8TUtgRy2Y0efE"></script>
<script>


</script>
<script type="text/javascript">
var studentArr=[];
var blinkArr=[]; 
<c:forEach items="${latlong}" var="latlng">
blinkArr.push("${latlng.blink_s}");
<c:choose><c:when test="${latlng.s_image!=''}">studentArr.push("<%=Assets.STUDENT_UPLOAD_PATH_DIS %>/${latlng.s_image}");	</c:when><c:otherwise>studentArr.push("resources/dashboard/Images/user_icon.png");</c:otherwise></c:choose>
</c:forEach> 
var position;
if("${first_lat_lng[0].lat}"!='')
	{
	position =[${first_lat_lng[0].lat},${first_lat_lng[0].lng}];
	}else
	{
		position =[${route.source_lat},${route.source_lng}];
	}

var map;
/*var directionDisplay;*/
var directionsService1;
var directionsDisplay = [];
var directionsService = [];
var stepDisplay;
var markerArray = [];
//var position;
var marker = null;
var markerLatest = null;
var polyline = null;
var poly2 = null;
var speed = 0.000005,
  wait = 1;
var infowindow = null;
var timerHandle = null;
function initialize() {


	var msg = '${route.source_lat},${route.source_lng}:${route.source_lat},${route.source_lng}:<c:forEach items="${latlong}" var="latlng"> ${latlng.lat},${latlng.lng}:</c:forEach>${route.destination_lat},${route.destination_lng}:${route.destination_lat},${route.destination_lng}';
	var input_msg = msg.split(":");
    var locations = new Array();
    //alert(input_msg.length);
    var bounds = new google.maps.LatLngBounds();
    for (var i = 0; i < input_msg.length; i++) {
      var tmp_lat_lng = input_msg[i].split(",");
      locations.push(new google.maps.LatLng(tmp_lat_lng[0],
          tmp_lat_lng[1]));
      bounds.extend(locations[locations.length - 1]);
    }
    var contentString='';
    var locations1 = [ 

['${school_details.school_address_field}','${school_details.school_lat}','${school_details.school_lng}','resources/dashboard/Images/school_icon.png'],
['${school_details.school_name}','${route.source_lat}','${route.source_lng}','resources/dashboard/Images/blue_marker.png'],		                  
<c:forEach items="${latlong}" var="latlng">
[<c:choose><c:when test="${latlng.s_image!=''}">'<div class="map_info-win"><img  src="<%=Assets.STUDENT_UPLOAD_PATH_DIS %>/${latlng.s_image}" /></c:when><c:otherwise>'<div class="map_info-win"><img src="resources/dashboard/Images/user_icon.png" /></c:otherwise></c:choose><div><p>Name : ${latlng.student_name}</p><p>Class : ${latlng.s_class}</p></div></div>',"${latlng.lat}","${latlng.lng}",'<c:choose><c:when test="${latlng.s_image!=''}"><%=Assets.STUDENT_UPLOAD_PATH_DIS %>/${latlng.s_image}	</c:when><c:otherwise>resources/dashboard/Images/user_icon.png</c:otherwise></c:choose>'],
</c:forEach>        
['${route.destination}','${route.destination_lat}','${route.destination_lng}','resources/dashboard/Images/green_marker.png'],		                   
		      
		        
		        
];

var mapOptions = {
  center: new google.maps.LatLng("${school_details.school_lat}","${school_details.school_lng}"),
  zoom : 14,
  mapTypeId : google.maps.MapTypeId.ROADMAP
};
map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
var latlngLatest = new google.maps.LatLng(position[0],position[1]);
var car1="m4.548714,1c0.537629,0 1.075257,0 1.612621,0c0.038175,0.041886 0.089075,0.023064 0.134142,0.026245c0.606025,0.040826 1.207013,0.109753 1.800844,0.24575c0.32157,0.073433 0.525699,0.260596 0.667529,0.543726c0.211817,0.422574 0.265103,0.875635 0.290022,1.33983c0.033668,0.624052 0.02598,1.247839 0.026245,1.871891c0,0.130165 -0.001326,0.260066 0.000795,0.390231c0.00053,0.033933 -0.014581,0.084833 0.055141,0.074229c0.148192,-0.022269 0.280479,0.042947 0.4125,0.090135c0.122478,0.044007 0.218445,0.126189 0.211817,0.278623c-0.004242,0.098353 -0.041356,0.146602 -0.147662,0.116645c-0.112669,-0.031547 -0.226663,-0.058058 -0.340127,-0.086424c-0.192995,-0.048514 -0.192995,-0.048249 -0.192995,0.153495c0,6.086231 0,12.172462 0,18.258427c0,0.216589 0.003181,0.433443 -0.003977,0.650032c-0.015111,0.455447 -0.28313,0.771449 -0.725056,0.856547c-0.383339,0.073964 -0.770654,0.119561 -1.160885,0.136263c-1.174406,0.05037 -2.348811,0.030222 -3.523217,-0.008748c-0.424165,-0.01405 -0.847799,-0.046923 -1.267192,-0.121947c-0.426285,-0.07635 -0.679989,-0.325811 -0.744409,-0.753422c-0.038705,-0.25821 -0.019087,-0.519336 -0.019087,-0.778872c-0.000265,-6.064492 0,-12.128985 0,-18.193477c0,-0.043477 -0.003711,-0.087219 0.000795,-0.1299c0.009279,-0.088544 -0.022269,-0.116115 -0.110018,-0.09093c-0.12884,0.037114 -0.259801,0.068131 -0.389966,0.100474c-0.156941,0.03897 -0.207576,-0.009544 -0.182656,-0.169401c0.011665,-0.075554 0.056202,-0.124333 0.11479,-0.165159c0.132286,-0.092256 0.290288,-0.14236 0.439275,-0.140505c0.139974,0.001591 0.128045,-0.054346 0.12831,-0.144481c0.003181,-0.714982 -0.020943,-1.430495 0.022534,-2.145212c0.007423,-0.120092 0.048514,-0.237532 0.02704,-0.359479c0.003446,-0.001856 0.006893,-0.003711 0.010339,-0.005302c-0.002651,0.002651 -0.005567,0.005567 -0.008483,0.008218c-0.033138,-0.021208 -0.022799,-0.053551 -0.018822,-0.082182c0.044272,-0.318654 0.125129,-0.626968 0.260066,-0.920172c0.14289,-0.310435 0.364781,-0.509263 0.711536,-0.581636c0.475329,-0.099148 0.95331,-0.170461 1.436327,-0.214203c0.157471,-0.014316 0.318389,0.00106 0.471883,-0.049309zm-2.373996,4.024791c-0.007953,0.132551 0.014581,0.278358 0.040826,0.422574c0.093846,0.518011 0.199092,1.034166 0.285781,1.553238c0.019618,0.117706 0.055406,0.135202 0.161448,0.121947c0.682905,-0.085098 1.366075,-0.160917 2.054547,-0.191934c0.768268,-0.034463 1.532825,-0.000265 2.296851,0.071843c0.340127,0.032343 0.679193,0.076085 1.01826,0.116115c0.101269,0.01193 0.161448,0.008218 0.175498,-0.128575c0.035259,-0.343573 0.116645,-0.680519 0.187958,-1.01879c0.072373,-0.342513 0.146867,-0.685291 0.138649,-1.038673c-0.008483,-0.377772 -0.145807,-0.586407 -0.464725,-0.680519c-0.636512,-0.187693 -1.288135,-0.295059 -1.949036,-0.344369c-0.793453,-0.059118 -1.583724,-0.02545 -2.368959,0.103125c-0.387315,0.06336 -0.7741,0.130961 -1.148691,0.254234c-0.2317,0.07635 -0.365842,0.2317 -0.409054,0.472413c-0.016171,0.091195 -0.018557,0.1808 -0.019353,0.287371zm3.300265,19.649952c0.654274,0.009809 1.40531,-0.058058 2.157142,-0.107102c0.296385,-0.019353 0.389171,-0.112669 0.378037,-0.407463c-0.002916,-0.077675 -0.034198,-0.110813 -0.106571,-0.11532c-0.047453,-0.002916 -0.095172,-0.011134 -0.14236,-0.008218c-0.513769,0.032077 -1.027539,0.061769 -1.542633,0.075554c-0.983797,0.02598 -1.965738,0.00053 -2.947413,-0.060709c-0.150844,-0.009544 -0.302482,-0.025715 -0.454386,-0.007423c-0.038705,0.004772 -0.079266,0.006097 -0.104185,0.042682c-0.046658,0.068397 -0.000795,0.328993 0.062299,0.38652c0.122212,0.111608 0.274647,0.088279 0.419393,0.099944c0.725586,0.058058 1.451703,0.105776 2.28068,0.101534zm2.646522,-3.035427c0,0 0.000265,0 0.00053,0c0,0.511118 0,1.021971 0,1.533355c0,0.095702 0.003711,0.190874 0.058323,0.275177c0.085628,0.131756 0.248401,0.19273 0.397654,0.148192c0.15588,-0.046128 0.249992,-0.1808 0.250522,-0.382808c0.002121,-1.048217 0.000265,-2.096433 0.002121,-3.144385c0.000265,-0.099414 -0.032873,-0.108162 -0.125129,-0.092256c-0.152699,0.02651 -0.311761,0.031547 -0.46393,-0.002121c-0.107632,-0.023859 -0.122743,0.010339 -0.121947,0.105511c0.003711,0.519867 0.001856,1.039733 0.001856,1.559335zm-6.282937,0.039765c0,0.519336 -0.000265,1.038938 0.000265,1.558274c0,0.068662 -0.003711,0.138119 0.024655,0.204394c0.065746,0.15429 0.225072,0.242039 0.389966,0.211817c0.16675,-0.030487 0.286841,-0.182391 0.287371,-0.381218c0.001856,-1.06916 0,-2.138319 0.002651,-3.207744c0.000265,-0.093846 -0.035259,-0.108162 -0.116645,-0.093051c-0.161713,0.030222 -0.325281,0.030487 -0.486994,0c-0.073964,-0.013785 -0.104451,-0.007953 -0.103655,0.083772c0.005037,0.54134 0.002386,1.08268 0.002386,1.623755zm5.58174,-20.105399c-0.017232,0 -0.034728,0 -0.05196,0c-0.163568,-0.001856 -0.168075,0.001591 -0.105511,0.152169c0.127249,0.305398 0.301422,0.582961 0.519336,0.831893c0.088809,0.101269 0.187693,0.192465 0.308315,0.255029c0.255559,0.133347 0.565199,0.059118 0.667794,-0.158531c0.082977,-0.176293 -0.007953,-0.32263 -0.098088,-0.455712c-0.295325,-0.436359 -0.745469,-0.576864 -1.239886,-0.624847zm-5.077515,1.30139c0.121152,0.003711 0.235411,-0.023329 0.331909,-0.094642c0.389171,-0.288167 0.622992,-0.688472 0.800345,-1.128013c0.020678,-0.05143 0.009279,-0.080061 -0.055141,-0.079531c-0.551679,0.006097 -1.037612,0.162773 -1.371642,0.630945c-0.094907,0.132817 -0.176293,0.290818 -0.084303,0.470027c0.080326,0.156941 0.221096,0.194055 0.378832,0.201213zm0.197767,12.789886c0,-0.250787 -0.001856,-0.502105 0.00106,-0.752892c0.000795,-0.069987 -0.016701,-0.100474 -0.093846,-0.098353c-0.172847,0.005037 -0.346224,0.004772 -0.519071,0c-0.069722,-0.001856 -0.088279,0.023329 -0.088014,0.08934c0.001856,0.50184 0.002386,1.003944 -0.00053,1.505784c-0.00053,0.078205 0.031017,0.093051 0.099414,0.09146c0.168605,-0.003446 0.337476,-0.004507 0.506081,0.00053c0.075024,0.002121 0.096763,-0.023859 0.095702,-0.096232c-0.002916,-0.246281 -0.00106,-0.493091 -0.000795,-0.739637zm-0.00053,1.730856c0,-0.246546 -0.001856,-0.493091 0.00106,-0.739902c0.00053,-0.069192 -0.014846,-0.101269 -0.093051,-0.099148c-0.172847,0.005567 -0.346224,0.004507 -0.519071,0.000265c-0.068927,-0.001591 -0.088279,0.023329 -0.088014,0.089605c0.001856,0.493356 0.002916,0.986713 -0.00053,1.479804c-0.00053,0.081917 0.03791,0.099944 0.101799,0.087219c0.158531,-0.031547 0.316533,-0.020413 0.474534,0.001591c0.093846,0.01299 0.129105,-0.017762 0.125924,-0.118766c-0.007688,-0.23329 -0.002651,-0.467111 -0.002651,-0.700667zm-0.69722,0.86291c0,0.536833 0.000795,1.072871 -0.00106,1.608644c0,0.053816 0.013785,0.067601 0.066276,0.059118c0.17974,-0.028896 0.359745,-0.030222 0.539749,0.002386c0.064155,0.011399 0.093581,-0.009809 0.093316,-0.081917c-0.002121,-0.506877 -0.001326,-1.013488 -0.001326,-1.520365c0,-0.048779 -0.003446,-0.075289 -0.072903,-0.066276c-0.20519,0.026775 -0.411705,0.021473 -0.624052,-0.001591zm0,-6.841774c0,0.536833 0.000795,1.072871 -0.001326,1.609174c0,0.053551 0.011134,0.069192 0.064155,0.059913c0.188488,-0.032873 0.378302,-0.027571 0.56679,-0.002651c0.058058,0.007688 0.067336,-0.011399 0.067071,-0.059383c-0.00053,-0.511648 -0.00053,-1.023032 0,-1.53468c0,-0.062034 -0.017497,-0.072108 -0.085628,-0.066276c-0.201478,0.017497 -0.404282,0.020413 -0.611062,-0.006097zm6.479378,-2.608347c0,0.151639 0,0.303013 0,0.454386c0,0.008748 -0.00053,0.017497 0,0.02598c0.009013,0.098883 0.013255,0.198827 0.029692,0.296385c0.007158,0.042947 0.005037,0.107102 0.090135,0.094377c0.209696,-0.031017 0.26961,-0.086954 0.320244,-0.294264c0.057262,-0.233556 0.05037,-0.472413 0.06495,-0.708885c0.027836,-0.448554 0.044272,-0.897903 0.066276,-1.346987c0.003181,-0.062564 -0.010339,-0.092786 -0.080061,-0.061769c-0.125659,0.055672 -0.250787,0.112934 -0.379892,0.159857c-0.055141,0.019883 -0.057527,0.053021 -0.060709,0.097823c-0.031017,0.427346 -0.054876,0.854692 -0.050635,1.283098zm-5.782158,5.135307c0,-0.242304 0,-0.484343 0,-0.726382c0,-0.047719 0.008748,-0.10286 -0.068927,-0.088544c-0.183981,0.033668 -0.367167,0.028631 -0.551414,-0.000795c-0.040031,-0.006362 -0.080061,-0.014581 -0.079531,0.059648c0.004242,0.492826 0.003711,0.985917 0.000795,1.478744c-0.00053,0.079796 0.034463,0.091991 0.101534,0.090665c0.164364,-0.003181 0.328728,-0.005832 0.492826,0.00106c0.091195,0.003977 0.107102,-0.034198 0.105776,-0.113729c-0.003711,-0.233821 -0.00106,-0.467111 -0.00106,-0.700667zm5.589693,1.716276c0,0.246546 0.001591,0.493091 -0.00106,0.739637c-0.000795,0.068397 0.01352,0.109222 0.092256,0.097823c0.171256,-0.024655 0.342513,-0.01405 0.513504,0.000795c0.069987,0.006097 0.088544,-0.023064 0.088279,-0.088544c-0.001591,-0.50184 -0.001856,-1.003414 0,-1.505254c0.000265,-0.066276 -0.020413,-0.090665 -0.089075,-0.088809c-0.164099,0.004242 -0.328993,0.007158 -0.492826,-0.000795c-0.095702,-0.004772 -0.11479,0.032343 -0.112934,0.118501c0.005037,0.242304 0.001856,0.484343 0.001856,0.726647zm-5.745839,-6.769931c0,-0.226398 0.002916,-0.378037 -0.000795,-0.529675c-0.003711,-0.155615 -0.015641,-0.311496 -0.021208,-0.467376c-0.016171,-0.442987 -0.016436,-0.441131 -0.427081,-0.604434c-0.090135,-0.035789 -0.123008,-0.02651 -0.117175,0.079001c0.023064,0.410644 0.032873,0.822349 0.06389,1.232198c0.015376,0.202804 0.003446,0.407198 0.040296,0.608676c0.020148,0.110548 0.032608,0.222421 0.081387,0.325546c0.058323,0.123273 0.185042,0.135998 0.288432,0.136793c0.089075,0.00053 0.062564,-0.113464 0.075024,-0.181065c0.040561,-0.223482 0.007953,-0.449614 0.017232,-0.599663zm6.437757,8.492304c0,-0.233556 -0.003977,-0.467376 0.002121,-0.700932c0.002386,-0.093581 -0.019618,-0.131226 -0.121417,-0.125129c-0.155085,0.009279 -0.311496,0.006893 -0.467111,0.00053c-0.081917,-0.003446 -0.108692,0.016436 -0.107632,0.10392c0.004772,0.48885 0.004507,0.977964 0,1.466814c-0.000795,0.079796 0.026245,0.097028 0.094112,0.086954c0.162508,-0.024389 0.325016,-0.027306 0.487524,-0.000265c0.093846,0.015641 0.116115,-0.031017 0.114259,-0.117706c-0.005037,-0.238062 -0.001856,-0.476125 -0.001856,-0.714187zm-0.691653,-5.145646c0,0.259536 0.000265,0.519336 -0.000265,0.779137c0,0.037645 -0.018822,0.079001 0.052225,0.068662c0.192465,-0.028101 0.385725,-0.030222 0.578189,0.001856c0.039235,0.006362 0.062829,0.002121 0.062564,-0.051165c-0.002386,-0.515095 -0.002121,-1.03019 -0.002386,-1.545284c0,-0.058323 -0.01299,-0.080591 -0.084303,-0.070517c-0.17974,0.02545 -0.362396,0.02545 -0.542135,0.00053c-0.069987,-0.009809 -0.066276,0.009279 -0.06548,0.063625c0.003711,0.251052 0.001591,0.502105 0.001591,0.753157zm0.000265,6.852908c0,0.255559 0.003181,0.511118 -0.001856,0.766412c-0.001326,0.067336 0.014846,0.081652 0.07847,0.069987c0.170991,-0.031017 0.343308,-0.028631 0.514034,-0.000795c0.076615,0.01246 0.101269,-0.010604 0.100474,-0.085363c-0.002651,-0.203599 -0.000795,-0.407198 -0.000795,-0.610532c0,-0.290288 -0.000265,-0.58031 0.000265,-0.870598c0,-0.066276 0.004772,-0.104185 -0.096497,-0.092256c-0.174703,0.020678 -0.354973,0.025185 -0.529941,-0.005037c-0.071313,-0.01246 -0.066276,0.008218 -0.065746,0.061769c0.003181,0.255294 0.001326,0.510853 0.001591,0.766412zm0.691123,-5.160757c0,-0.242304 -0.00106,-0.484608 0.00106,-0.726912c0.00053,-0.0509 0,-0.083772 -0.066541,-0.072373c-0.183716,0.031812 -0.367433,0.030487 -0.551679,-0.001326c-0.044802,-0.007688 -0.07741,-0.007423 -0.07688,0.062829c0.004507,0.48885 0.004507,0.977699 0.001326,1.466549c-0.00053,0.084038 0.033403,0.101269 0.107897,0.099148c0.155615,-0.004242 0.311761,-0.005567 0.467111,0.00053c0.088544,0.003711 0.121417,-0.021473 0.119296,-0.11479c-0.005832,-0.237797 -0.001856,-0.47586 -0.001591,-0.713657zm0.009013,-2.950595c0,0 -0.000265,0 -0.00053,0c0,-0.099414 0.004242,-0.199357 -0.000795,-0.298506c-0.01193,-0.233025 -0.152964,-0.375386 -0.362396,-0.371674c-0.199622,0.003446 -0.337476,0.149783 -0.344103,0.377506c-0.005832,0.203334 0.001326,0.406933 -0.003446,0.610267c-0.001326,0.066011 0.022799,0.090135 0.081387,0.078736c0.175498,-0.034198 0.350466,-0.025715 0.525169,0.00106c0.091991,0.014316 0.109753,-0.032873 0.105776,-0.111608c-0.004772,-0.095172 -0.00106,-0.190344 -0.00106,-0.285781zm-6.288504,-0.002916c-0.00106,0 -0.001856,0 -0.002916,0c0,-0.112669 0.008483,-0.226133 -0.001856,-0.337476c-0.018557,-0.204129 -0.168605,-0.33456 -0.363721,-0.328993c-0.192995,0.005567 -0.329523,0.147662 -0.333764,0.356298c-0.004507,0.216589 0.002121,0.433178 -0.005567,0.649767c-0.002121,0.064685 0.028366,0.066276 0.066806,0.058853c0.183981,-0.034994 0.367433,-0.028101 0.551414,0.000795c0.065746,0.010339 0.093581,-0.018027 0.090665,-0.087484c-0.004507,-0.103655 -0.00106,-0.207841 -0.00106,-0.311761zm6.412042,-4.683042c0.01299,-0.098088 0.003446,-0.248666 -0.003977,-0.400305c-0.005832,-0.121417 -0.060178,-0.154555 -0.169401,-0.156941c-0.105511,-0.001856 -0.130696,0.067071 -0.150313,0.145276c-0.111078,0.440601 -0.145011,0.893927 -0.221891,1.34036c-0.011134,0.06389 0.01246,0.07794 0.072108,0.051165c0.117175,-0.052755 0.235942,-0.102595 0.354973,-0.150578c0.059383,-0.023859 0.082977,-0.060443 0.084833,-0.126984c0.006097,-0.216324 0.019883,-0.432383 0.033668,-0.701992zm-7.184552,0.062564c0,0.061769 -0.003181,0.156941 0.000795,0.251848c0.006628,0.151109 -0.020413,0.319184 0.038175,0.447759c0.061239,0.135468 0.260596,0.123008 0.386785,0.200948c0.003711,0.002121 0.007688,0.004242 0.011665,0.005302c0.027836,0.007423 0.054081,0.040296 0.083507,0.018557c0.028896,-0.021208 0.011399,-0.054876 0.007158,-0.084303c-0.039235,-0.272791 -0.073433,-0.546377 -0.117706,-0.818107c-0.029161,-0.178149 -0.052225,-0.358154 -0.106836,-0.531266c-0.031282,-0.098618 -0.098883,-0.113199 -0.192995,-0.10286c-0.092786,0.010074 -0.109753,0.062034 -0.11532,0.138914c-0.010339,0.146602 -0.020943,0.293204 0.004772,0.473209zm3.622365,-4.83468c0.017497,-0.002651 0.073168,-0.009544 0.12778,-0.020678c0.028896,-0.005832 0.064155,-0.014846 0.066011,-0.051165c0.001591,-0.038175 -0.036584,-0.046393 -0.063094,-0.054611c-0.118766,-0.035259 -0.238327,-0.035259 -0.356563,0.003181c-0.023329,0.007688 -0.053551,0.016701 -0.054876,0.047984c-0.001326,0.031282 0.027836,0.040296 0.051165,0.049574c0.061239,0.023859 0.126189,0.026775 0.229579,0.025715z";

//var car1 = "M17.402,0H5.643C2.526,0,0,3.467,0,6.584v34.804c0,3.116,2.526,5.644,5.643,5.644h11.759c3.116,0,5.644-2.527,5.644-5.644 V6.584C23.044,3.467,20.518,0,17.402,0z M22.057,14.188v11.665l-2.729,0.351v-4.806L22.057,14.188z M20.625,10.773 c-1.016,3.9-2.219,8.51-2.219,8.51H4.638l-2.222-8.51C2.417,10.773,11.3,7.755,20.625,10.773z M3.748,21.713v4.492l-2.73-0.349 V14.502L3.748,21.713z M1.018,37.938V27.579l2.73,0.343v8.196L1.018,37.938z M2.575,40.882l2.218-3.336h13.771l2.219,3.336H2.575z M19.328,35.805v-7.872l2.729-0.355v10.048L19.328,35.805z";
//var car = "M 236.54427,9.8485 C 220.2445,9.8485 204.45277,15.405415 191.41289,25.550223 L 97.337229,97.995127 L -135.0706,131.12201 C -150.90459,133.65817 -161.13586,149.44963 -156.32358,165.14237 L -132.57022,244.60846 L -86.188678,244.60846 C -90.823109,289.62242 -60.00389,319.2235 -20.679452,319.2235 C 18.644986,319.2235 49.844083,285.73585 44.829779,244.60846 L 425.19586,244.60846 C 419.65783,289.49008 452.23789,319.2235 490.70508,319.2235 C 529.17227,319.2235 561.22444,285.70267 556.21433,244.60846 L 651.04018,244.60846 C 659.88863,244.60846 667.48002,236.98237 667.48,227.63005 L 667.48,137.76012 C 667.48,129.20037 661.30023,122.08284 653.22799,120.97335 L 491.76774,97.995127 L 427.82125,32.635149 C 413.84999,18.051989 394.74442,10.165524 374.56372,9.8485 L 236.54427,9.8485 z M 304.42883,37.42226 L 378.62679,37.42226 C 389.64854,37.42226 399.73373,43.261111 405.94316,52.613356 L 424.25825,80.825395 C 428.78955,88.722668 423.85522,96.409133 415.38198,97.803717 L 304.42883,97.803717 L 304.42883,37.42226 z M 224.60508,37.549916 L 283.42586,37.549916 L 283.42586,97.803717 L 132.59212,97.803717 L 200.10167,45.97523 C 207.08728,40.585799 215.91189,37.549914 224.60508,37.549916 z";
var icon1 = {
    geodesic: true,
    path: car1,
    scale: 1.2,
    strokeColor: 'white',
    strokeWeight: .10,
    fillOpacity: 1,
    fillColor: 'blue',
    offset: '5%',
   // rotation: 90,
    anchor: new google.maps.Point(10, 25) // orig 10,50 back of car, 10,0 front of car, 10,25 center of car
  };
   markerLatest = new google.maps.Marker({
        position: latlngLatest,
        map: map,
        title: "Your current location!",
        icon: icon1
    }); 
    
    google.maps.event.addListener(map, 'click', function(me) {
    
      //  var result = [me.latLng.lat(), me.latLng.lng()];
     //   transition(result);
    });
    
    
    // Limit the zoom level
    google.maps.event.addListener(map, 'zoom_changed', function() {
    	 map.setOptions({maxZoom:15,minZoom:8});
    });
    
    
     /*map.fitBounds(bounds);
  
    google.maps.event.addDomListener(window, 'resize', function() {
      google.maps.event.trigger(map, 'resize');
     map.fitBounds(bounds);
    });
*/
      polyline = new google.maps.Polyline({
      path: [],
      strokeColor: '#FF0000',
      strokeWeight: 3
      });
      poly2 = new google.maps.Polyline({
      path: [],
      strokeColor: '#FF0000',
      strokeWeight: 3
      });
   var infowindow = new google.maps.InfoWindow();

    var marker, i;
     var index=0;
    for (i = 0; i < locations1.length; i++) {
      marker = new google.maps.Marker({
        position : new google.maps.LatLng(locations1[i][1],
            locations1[i][2]),
        map : map,
        icon :{ url:locations1[i][3],
          scaledSize: new google.maps.Size(45, 45),
                    anchor: new google.maps.Point(10, 25)
        },
        optimized:false
        
      });
       var myoverlay = new google.maps.OverlayView();
         myoverlay.draw = function () {
          
             this.getPanes().markerLayer.id='markerLayer';
         };
         myoverlay.setMap(map);
       
        
      google.maps.event.addListener(marker, 'click',
          (function(marker, i) {
            return function() {
              infowindow.setContent(locations1[i][0]);
              infowindow.open(map, marker);
            }
          })(marker, i));
    }

    var oldRadius="${route.radius}";
    var resArr = oldRadius.split(":");
    var resStr='';
    var pos;
    var triangleCoords=[];
    
    if(resArr.length>1)
    {
      
    }else{
      triangleCoords.push(new google.maps.LatLng(22.7195687,75.8577258));
    }
                              
    if(resArr.length>1)
      {
    
        for(var m=0;m<resArr.length;m++)
        {
          if(m==resArr.length-1)
          {
            resStr+=resArr[m];
          }else{
              resStr+=resArr[m]+",";  
          }
            
        } 
        resArr1 = resStr.split(",");
         
        for(var n=0;n<resArr1.length;n++)
        {
          pos=new google.maps.LatLng(resArr1[n],resArr1[n+1]);
          triangleCoords.push(pos);
          n=n+1;
        } 
    
      }
    
    if(resArr.length>1)
    {
      
    }else{
      triangleCoords.push(new google.maps.LatLng(22.7195687,75.8577258));
    }
      
    
    
    
    // Styling & Controls
    myPolygon = new google.maps.Polygon({
      paths : triangleCoords,
      draggable : false, // turn off if it gets annoying
      editable : false,
      strokeColor : '#FF0000',
      strokeOpacity : 0.8,
      strokeWeight : 2,
      fillColor : '#FF0000',
      fillOpacity : 0.35
    });

    myPolygon.setMap(map);
    //google.maps.event.addListener(myPolygon, "dragend", getPolygonCoords);
    google.maps.event.addListener(myPolygon.getPath(), "insert_at",getPolygonCoords);
    //google.maps.event.addListener(myPolygon.getPath(), "remove_at", getPolygonCoords);
    google.maps.event.addListener(myPolygon.getPath(), "set_at",getPolygonCoords);

    
  
    var i = locations.length;
    var index = 0;

    while (i != 0) {

      if (i < 3) {
        var tmp_locations = new Array();
        for (var j = index; j < locations.length; j++) {
          tmp_locations.push(locations[index]);
        }
        drawRouteMap(tmp_locations);
        i = 0;
        index = locations.length;
      }

      if (i >= 3 && i <= 10) {
        var tmp_locations = new Array();
        for (var j = index; j < locations.length; j++) {
          tmp_locations.push(locations[j]);
        }
        drawRouteMap(tmp_locations);
        i = 0;
        index = locations.length;
      }

      if (i >= 10) {
        var tmp_locations = new Array();
        for (var j = index; j < index + 10; j++) {
          tmp_locations.push(locations[j]);
        }
        drawRouteMap(tmp_locations);
        i = i - 9;
        index = index + 9;
     }
    }
    directionsService1 = new google.maps.DirectionsService();
 

}




function drawRouteMap(locations) {

    var start, end;
    var waypts = [];

    for (var k = 0; k < locations.length; k++) {
      if (k >= 1 && k <= locations.length - 2) {
        waypts.push({
          location : locations[k],
          stopover : true
        });
      }
      if (k == 0)
        start = locations[k];

      if (k == locations.length - 1)
        end = locations[k];

    }
    var request = {
      origin : start,
      destination : end,
      waypoints : waypts,
      travelMode : google.maps.TravelMode.DRIVING
    };
   

    directionsService.push(new google.maps.DirectionsService());
    var instance = directionsService.length - 1;
    directionsDisplay.push(new google.maps.DirectionsRenderer({
      preserveViewport : true,
      suppressMarkers : true
    }));
    directionsDisplay[instance].setMap(map);
    directionsService[instance].route(request, function(response, status) {
      if (status == google.maps.DirectionsStatus.OK) {
    
        directionsDisplay[instance].setDirections(response);
      }
    });
  }

/* custom rotation of marker*/
function updateMarker(marker, latitude, longitude, label) {
  var prevPosn = marker.getPosition();
  var bounds = new google.maps.LatLngBounds();
  var latlng = new google.maps.LatLng(latitude, longitude);
  marker.setPosition(latlng );
  
  
 // var car1 = "M17.402,0H5.643C2.526,0,0,3.467,0,6.584v34.804c0,3.116,2.526,5.644,5.643,5.644h11.759c3.116,0,5.644-2.527,5.644-5.644 V6.584C23.044,3.467,20.518,0,17.402,0z M22.057,14.188v11.665l-2.729,0.351v-4.806L22.057,14.188z M20.625,10.773 c-1.016,3.9-2.219,8.51-2.219,8.51H4.638l-2.222-8.51C2.417,10.773,11.3,7.755,20.625,10.773z M3.748,21.713v4.492l-2.73-0.349 V14.502L3.748,21.713z M1.018,37.938V27.579l2.73,0.343v8.196L1.018,37.938z M2.575,40.882l2.218-3.336h13.771l2.219,3.336H2.575z M19.328,35.805v-7.872l2.729-0.355v10.048L19.328,35.805z";
 var car1="m4.548714,1c0.537629,0 1.075257,0 1.612621,0c0.038175,0.041886 0.089075,0.023064 0.134142,0.026245c0.606025,0.040826 1.207013,0.109753 1.800844,0.24575c0.32157,0.073433 0.525699,0.260596 0.667529,0.543726c0.211817,0.422574 0.265103,0.875635 0.290022,1.33983c0.033668,0.624052 0.02598,1.247839 0.026245,1.871891c0,0.130165 -0.001326,0.260066 0.000795,0.390231c0.00053,0.033933 -0.014581,0.084833 0.055141,0.074229c0.148192,-0.022269 0.280479,0.042947 0.4125,0.090135c0.122478,0.044007 0.218445,0.126189 0.211817,0.278623c-0.004242,0.098353 -0.041356,0.146602 -0.147662,0.116645c-0.112669,-0.031547 -0.226663,-0.058058 -0.340127,-0.086424c-0.192995,-0.048514 -0.192995,-0.048249 -0.192995,0.153495c0,6.086231 0,12.172462 0,18.258427c0,0.216589 0.003181,0.433443 -0.003977,0.650032c-0.015111,0.455447 -0.28313,0.771449 -0.725056,0.856547c-0.383339,0.073964 -0.770654,0.119561 -1.160885,0.136263c-1.174406,0.05037 -2.348811,0.030222 -3.523217,-0.008748c-0.424165,-0.01405 -0.847799,-0.046923 -1.267192,-0.121947c-0.426285,-0.07635 -0.679989,-0.325811 -0.744409,-0.753422c-0.038705,-0.25821 -0.019087,-0.519336 -0.019087,-0.778872c-0.000265,-6.064492 0,-12.128985 0,-18.193477c0,-0.043477 -0.003711,-0.087219 0.000795,-0.1299c0.009279,-0.088544 -0.022269,-0.116115 -0.110018,-0.09093c-0.12884,0.037114 -0.259801,0.068131 -0.389966,0.100474c-0.156941,0.03897 -0.207576,-0.009544 -0.182656,-0.169401c0.011665,-0.075554 0.056202,-0.124333 0.11479,-0.165159c0.132286,-0.092256 0.290288,-0.14236 0.439275,-0.140505c0.139974,0.001591 0.128045,-0.054346 0.12831,-0.144481c0.003181,-0.714982 -0.020943,-1.430495 0.022534,-2.145212c0.007423,-0.120092 0.048514,-0.237532 0.02704,-0.359479c0.003446,-0.001856 0.006893,-0.003711 0.010339,-0.005302c-0.002651,0.002651 -0.005567,0.005567 -0.008483,0.008218c-0.033138,-0.021208 -0.022799,-0.053551 -0.018822,-0.082182c0.044272,-0.318654 0.125129,-0.626968 0.260066,-0.920172c0.14289,-0.310435 0.364781,-0.509263 0.711536,-0.581636c0.475329,-0.099148 0.95331,-0.170461 1.436327,-0.214203c0.157471,-0.014316 0.318389,0.00106 0.471883,-0.049309zm-2.373996,4.024791c-0.007953,0.132551 0.014581,0.278358 0.040826,0.422574c0.093846,0.518011 0.199092,1.034166 0.285781,1.553238c0.019618,0.117706 0.055406,0.135202 0.161448,0.121947c0.682905,-0.085098 1.366075,-0.160917 2.054547,-0.191934c0.768268,-0.034463 1.532825,-0.000265 2.296851,0.071843c0.340127,0.032343 0.679193,0.076085 1.01826,0.116115c0.101269,0.01193 0.161448,0.008218 0.175498,-0.128575c0.035259,-0.343573 0.116645,-0.680519 0.187958,-1.01879c0.072373,-0.342513 0.146867,-0.685291 0.138649,-1.038673c-0.008483,-0.377772 -0.145807,-0.586407 -0.464725,-0.680519c-0.636512,-0.187693 -1.288135,-0.295059 -1.949036,-0.344369c-0.793453,-0.059118 -1.583724,-0.02545 -2.368959,0.103125c-0.387315,0.06336 -0.7741,0.130961 -1.148691,0.254234c-0.2317,0.07635 -0.365842,0.2317 -0.409054,0.472413c-0.016171,0.091195 -0.018557,0.1808 -0.019353,0.287371zm3.300265,19.649952c0.654274,0.009809 1.40531,-0.058058 2.157142,-0.107102c0.296385,-0.019353 0.389171,-0.112669 0.378037,-0.407463c-0.002916,-0.077675 -0.034198,-0.110813 -0.106571,-0.11532c-0.047453,-0.002916 -0.095172,-0.011134 -0.14236,-0.008218c-0.513769,0.032077 -1.027539,0.061769 -1.542633,0.075554c-0.983797,0.02598 -1.965738,0.00053 -2.947413,-0.060709c-0.150844,-0.009544 -0.302482,-0.025715 -0.454386,-0.007423c-0.038705,0.004772 -0.079266,0.006097 -0.104185,0.042682c-0.046658,0.068397 -0.000795,0.328993 0.062299,0.38652c0.122212,0.111608 0.274647,0.088279 0.419393,0.099944c0.725586,0.058058 1.451703,0.105776 2.28068,0.101534zm2.646522,-3.035427c0,0 0.000265,0 0.00053,0c0,0.511118 0,1.021971 0,1.533355c0,0.095702 0.003711,0.190874 0.058323,0.275177c0.085628,0.131756 0.248401,0.19273 0.397654,0.148192c0.15588,-0.046128 0.249992,-0.1808 0.250522,-0.382808c0.002121,-1.048217 0.000265,-2.096433 0.002121,-3.144385c0.000265,-0.099414 -0.032873,-0.108162 -0.125129,-0.092256c-0.152699,0.02651 -0.311761,0.031547 -0.46393,-0.002121c-0.107632,-0.023859 -0.122743,0.010339 -0.121947,0.105511c0.003711,0.519867 0.001856,1.039733 0.001856,1.559335zm-6.282937,0.039765c0,0.519336 -0.000265,1.038938 0.000265,1.558274c0,0.068662 -0.003711,0.138119 0.024655,0.204394c0.065746,0.15429 0.225072,0.242039 0.389966,0.211817c0.16675,-0.030487 0.286841,-0.182391 0.287371,-0.381218c0.001856,-1.06916 0,-2.138319 0.002651,-3.207744c0.000265,-0.093846 -0.035259,-0.108162 -0.116645,-0.093051c-0.161713,0.030222 -0.325281,0.030487 -0.486994,0c-0.073964,-0.013785 -0.104451,-0.007953 -0.103655,0.083772c0.005037,0.54134 0.002386,1.08268 0.002386,1.623755zm5.58174,-20.105399c-0.017232,0 -0.034728,0 -0.05196,0c-0.163568,-0.001856 -0.168075,0.001591 -0.105511,0.152169c0.127249,0.305398 0.301422,0.582961 0.519336,0.831893c0.088809,0.101269 0.187693,0.192465 0.308315,0.255029c0.255559,0.133347 0.565199,0.059118 0.667794,-0.158531c0.082977,-0.176293 -0.007953,-0.32263 -0.098088,-0.455712c-0.295325,-0.436359 -0.745469,-0.576864 -1.239886,-0.624847zm-5.077515,1.30139c0.121152,0.003711 0.235411,-0.023329 0.331909,-0.094642c0.389171,-0.288167 0.622992,-0.688472 0.800345,-1.128013c0.020678,-0.05143 0.009279,-0.080061 -0.055141,-0.079531c-0.551679,0.006097 -1.037612,0.162773 -1.371642,0.630945c-0.094907,0.132817 -0.176293,0.290818 -0.084303,0.470027c0.080326,0.156941 0.221096,0.194055 0.378832,0.201213zm0.197767,12.789886c0,-0.250787 -0.001856,-0.502105 0.00106,-0.752892c0.000795,-0.069987 -0.016701,-0.100474 -0.093846,-0.098353c-0.172847,0.005037 -0.346224,0.004772 -0.519071,0c-0.069722,-0.001856 -0.088279,0.023329 -0.088014,0.08934c0.001856,0.50184 0.002386,1.003944 -0.00053,1.505784c-0.00053,0.078205 0.031017,0.093051 0.099414,0.09146c0.168605,-0.003446 0.337476,-0.004507 0.506081,0.00053c0.075024,0.002121 0.096763,-0.023859 0.095702,-0.096232c-0.002916,-0.246281 -0.00106,-0.493091 -0.000795,-0.739637zm-0.00053,1.730856c0,-0.246546 -0.001856,-0.493091 0.00106,-0.739902c0.00053,-0.069192 -0.014846,-0.101269 -0.093051,-0.099148c-0.172847,0.005567 -0.346224,0.004507 -0.519071,0.000265c-0.068927,-0.001591 -0.088279,0.023329 -0.088014,0.089605c0.001856,0.493356 0.002916,0.986713 -0.00053,1.479804c-0.00053,0.081917 0.03791,0.099944 0.101799,0.087219c0.158531,-0.031547 0.316533,-0.020413 0.474534,0.001591c0.093846,0.01299 0.129105,-0.017762 0.125924,-0.118766c-0.007688,-0.23329 -0.002651,-0.467111 -0.002651,-0.700667zm-0.69722,0.86291c0,0.536833 0.000795,1.072871 -0.00106,1.608644c0,0.053816 0.013785,0.067601 0.066276,0.059118c0.17974,-0.028896 0.359745,-0.030222 0.539749,0.002386c0.064155,0.011399 0.093581,-0.009809 0.093316,-0.081917c-0.002121,-0.506877 -0.001326,-1.013488 -0.001326,-1.520365c0,-0.048779 -0.003446,-0.075289 -0.072903,-0.066276c-0.20519,0.026775 -0.411705,0.021473 -0.624052,-0.001591zm0,-6.841774c0,0.536833 0.000795,1.072871 -0.001326,1.609174c0,0.053551 0.011134,0.069192 0.064155,0.059913c0.188488,-0.032873 0.378302,-0.027571 0.56679,-0.002651c0.058058,0.007688 0.067336,-0.011399 0.067071,-0.059383c-0.00053,-0.511648 -0.00053,-1.023032 0,-1.53468c0,-0.062034 -0.017497,-0.072108 -0.085628,-0.066276c-0.201478,0.017497 -0.404282,0.020413 -0.611062,-0.006097zm6.479378,-2.608347c0,0.151639 0,0.303013 0,0.454386c0,0.008748 -0.00053,0.017497 0,0.02598c0.009013,0.098883 0.013255,0.198827 0.029692,0.296385c0.007158,0.042947 0.005037,0.107102 0.090135,0.094377c0.209696,-0.031017 0.26961,-0.086954 0.320244,-0.294264c0.057262,-0.233556 0.05037,-0.472413 0.06495,-0.708885c0.027836,-0.448554 0.044272,-0.897903 0.066276,-1.346987c0.003181,-0.062564 -0.010339,-0.092786 -0.080061,-0.061769c-0.125659,0.055672 -0.250787,0.112934 -0.379892,0.159857c-0.055141,0.019883 -0.057527,0.053021 -0.060709,0.097823c-0.031017,0.427346 -0.054876,0.854692 -0.050635,1.283098zm-5.782158,5.135307c0,-0.242304 0,-0.484343 0,-0.726382c0,-0.047719 0.008748,-0.10286 -0.068927,-0.088544c-0.183981,0.033668 -0.367167,0.028631 -0.551414,-0.000795c-0.040031,-0.006362 -0.080061,-0.014581 -0.079531,0.059648c0.004242,0.492826 0.003711,0.985917 0.000795,1.478744c-0.00053,0.079796 0.034463,0.091991 0.101534,0.090665c0.164364,-0.003181 0.328728,-0.005832 0.492826,0.00106c0.091195,0.003977 0.107102,-0.034198 0.105776,-0.113729c-0.003711,-0.233821 -0.00106,-0.467111 -0.00106,-0.700667zm5.589693,1.716276c0,0.246546 0.001591,0.493091 -0.00106,0.739637c-0.000795,0.068397 0.01352,0.109222 0.092256,0.097823c0.171256,-0.024655 0.342513,-0.01405 0.513504,0.000795c0.069987,0.006097 0.088544,-0.023064 0.088279,-0.088544c-0.001591,-0.50184 -0.001856,-1.003414 0,-1.505254c0.000265,-0.066276 -0.020413,-0.090665 -0.089075,-0.088809c-0.164099,0.004242 -0.328993,0.007158 -0.492826,-0.000795c-0.095702,-0.004772 -0.11479,0.032343 -0.112934,0.118501c0.005037,0.242304 0.001856,0.484343 0.001856,0.726647zm-5.745839,-6.769931c0,-0.226398 0.002916,-0.378037 -0.000795,-0.529675c-0.003711,-0.155615 -0.015641,-0.311496 -0.021208,-0.467376c-0.016171,-0.442987 -0.016436,-0.441131 -0.427081,-0.604434c-0.090135,-0.035789 -0.123008,-0.02651 -0.117175,0.079001c0.023064,0.410644 0.032873,0.822349 0.06389,1.232198c0.015376,0.202804 0.003446,0.407198 0.040296,0.608676c0.020148,0.110548 0.032608,0.222421 0.081387,0.325546c0.058323,0.123273 0.185042,0.135998 0.288432,0.136793c0.089075,0.00053 0.062564,-0.113464 0.075024,-0.181065c0.040561,-0.223482 0.007953,-0.449614 0.017232,-0.599663zm6.437757,8.492304c0,-0.233556 -0.003977,-0.467376 0.002121,-0.700932c0.002386,-0.093581 -0.019618,-0.131226 -0.121417,-0.125129c-0.155085,0.009279 -0.311496,0.006893 -0.467111,0.00053c-0.081917,-0.003446 -0.108692,0.016436 -0.107632,0.10392c0.004772,0.48885 0.004507,0.977964 0,1.466814c-0.000795,0.079796 0.026245,0.097028 0.094112,0.086954c0.162508,-0.024389 0.325016,-0.027306 0.487524,-0.000265c0.093846,0.015641 0.116115,-0.031017 0.114259,-0.117706c-0.005037,-0.238062 -0.001856,-0.476125 -0.001856,-0.714187zm-0.691653,-5.145646c0,0.259536 0.000265,0.519336 -0.000265,0.779137c0,0.037645 -0.018822,0.079001 0.052225,0.068662c0.192465,-0.028101 0.385725,-0.030222 0.578189,0.001856c0.039235,0.006362 0.062829,0.002121 0.062564,-0.051165c-0.002386,-0.515095 -0.002121,-1.03019 -0.002386,-1.545284c0,-0.058323 -0.01299,-0.080591 -0.084303,-0.070517c-0.17974,0.02545 -0.362396,0.02545 -0.542135,0.00053c-0.069987,-0.009809 -0.066276,0.009279 -0.06548,0.063625c0.003711,0.251052 0.001591,0.502105 0.001591,0.753157zm0.000265,6.852908c0,0.255559 0.003181,0.511118 -0.001856,0.766412c-0.001326,0.067336 0.014846,0.081652 0.07847,0.069987c0.170991,-0.031017 0.343308,-0.028631 0.514034,-0.000795c0.076615,0.01246 0.101269,-0.010604 0.100474,-0.085363c-0.002651,-0.203599 -0.000795,-0.407198 -0.000795,-0.610532c0,-0.290288 -0.000265,-0.58031 0.000265,-0.870598c0,-0.066276 0.004772,-0.104185 -0.096497,-0.092256c-0.174703,0.020678 -0.354973,0.025185 -0.529941,-0.005037c-0.071313,-0.01246 -0.066276,0.008218 -0.065746,0.061769c0.003181,0.255294 0.001326,0.510853 0.001591,0.766412zm0.691123,-5.160757c0,-0.242304 -0.00106,-0.484608 0.00106,-0.726912c0.00053,-0.0509 0,-0.083772 -0.066541,-0.072373c-0.183716,0.031812 -0.367433,0.030487 -0.551679,-0.001326c-0.044802,-0.007688 -0.07741,-0.007423 -0.07688,0.062829c0.004507,0.48885 0.004507,0.977699 0.001326,1.466549c-0.00053,0.084038 0.033403,0.101269 0.107897,0.099148c0.155615,-0.004242 0.311761,-0.005567 0.467111,0.00053c0.088544,0.003711 0.121417,-0.021473 0.119296,-0.11479c-0.005832,-0.237797 -0.001856,-0.47586 -0.001591,-0.713657zm0.009013,-2.950595c0,0 -0.000265,0 -0.00053,0c0,-0.099414 0.004242,-0.199357 -0.000795,-0.298506c-0.01193,-0.233025 -0.152964,-0.375386 -0.362396,-0.371674c-0.199622,0.003446 -0.337476,0.149783 -0.344103,0.377506c-0.005832,0.203334 0.001326,0.406933 -0.003446,0.610267c-0.001326,0.066011 0.022799,0.090135 0.081387,0.078736c0.175498,-0.034198 0.350466,-0.025715 0.525169,0.00106c0.091991,0.014316 0.109753,-0.032873 0.105776,-0.111608c-0.004772,-0.095172 -0.00106,-0.190344 -0.00106,-0.285781zm-6.288504,-0.002916c-0.00106,0 -0.001856,0 -0.002916,0c0,-0.112669 0.008483,-0.226133 -0.001856,-0.337476c-0.018557,-0.204129 -0.168605,-0.33456 -0.363721,-0.328993c-0.192995,0.005567 -0.329523,0.147662 -0.333764,0.356298c-0.004507,0.216589 0.002121,0.433178 -0.005567,0.649767c-0.002121,0.064685 0.028366,0.066276 0.066806,0.058853c0.183981,-0.034994 0.367433,-0.028101 0.551414,0.000795c0.065746,0.010339 0.093581,-0.018027 0.090665,-0.087484c-0.004507,-0.103655 -0.00106,-0.207841 -0.00106,-0.311761zm6.412042,-4.683042c0.01299,-0.098088 0.003446,-0.248666 -0.003977,-0.400305c-0.005832,-0.121417 -0.060178,-0.154555 -0.169401,-0.156941c-0.105511,-0.001856 -0.130696,0.067071 -0.150313,0.145276c-0.111078,0.440601 -0.145011,0.893927 -0.221891,1.34036c-0.011134,0.06389 0.01246,0.07794 0.072108,0.051165c0.117175,-0.052755 0.235942,-0.102595 0.354973,-0.150578c0.059383,-0.023859 0.082977,-0.060443 0.084833,-0.126984c0.006097,-0.216324 0.019883,-0.432383 0.033668,-0.701992zm-7.184552,0.062564c0,0.061769 -0.003181,0.156941 0.000795,0.251848c0.006628,0.151109 -0.020413,0.319184 0.038175,0.447759c0.061239,0.135468 0.260596,0.123008 0.386785,0.200948c0.003711,0.002121 0.007688,0.004242 0.011665,0.005302c0.027836,0.007423 0.054081,0.040296 0.083507,0.018557c0.028896,-0.021208 0.011399,-0.054876 0.007158,-0.084303c-0.039235,-0.272791 -0.073433,-0.546377 -0.117706,-0.818107c-0.029161,-0.178149 -0.052225,-0.358154 -0.106836,-0.531266c-0.031282,-0.098618 -0.098883,-0.113199 -0.192995,-0.10286c-0.092786,0.010074 -0.109753,0.062034 -0.11532,0.138914c-0.010339,0.146602 -0.020943,0.293204 0.004772,0.473209zm3.622365,-4.83468c0.017497,-0.002651 0.073168,-0.009544 0.12778,-0.020678c0.028896,-0.005832 0.064155,-0.014846 0.066011,-0.051165c0.001591,-0.038175 -0.036584,-0.046393 -0.063094,-0.054611c-0.118766,-0.035259 -0.238327,-0.035259 -0.356563,0.003181c-0.023329,0.007688 -0.053551,0.016701 -0.054876,0.047984c-0.001326,0.031282 0.027836,0.040296 0.051165,0.049574c0.061239,0.023859 0.126189,0.026775 0.229579,0.025715z";

 marker.setIcon({
	geodesic: true,
    path: car1,
    strokeColor: 'red',
    strokeWeight: .10,
    fillOpacity: 1,
    fillColor: 'blue',
    scale: 1.2,
    offset: '5%',
    anchor: new google.maps.Point(10, 25), 
    rotation: google.maps.geometry.spherical.computeHeading(prevPosn, marker.getPosition())
  })
  if (label) {
    marker.setTitle(label);
  }
    bounds.extend(latlng);
    map.fitBounds(bounds); 
}


var numDeltas = 100;
var delay = 10; //milliseconds
var i = 0;
var deltaLat;
var deltaLng;
function transition(result){
    i = 0;
    deltaLat = (result[0] - position[0])/numDeltas;
    deltaLng = (result[1] - position[1])/numDeltas;
    moveMarker();
}

function moveMarker(){
    position[0] += deltaLat;
    position[1] += deltaLng;
    var prevPos= markerLatest.getPosition();
    var latlng = new google.maps.LatLng(position[0], position[1]);
    // markerLatest.setPosition(latlng);
    updateMarker(markerLatest, position[0], position[1], "current location");
    if(i!=numDeltas){
        i++;
        setTimeout(moveMarker, delay);
    }
}
//Function for change background color of marker
$(document).ready(function(){
	$.each(studentArr,function() {
		studentArr.push($.trim(this));
	});
	setTimeout(function(){
		changeBlinkStatus();			
	}, 3000); 
});

function changeBlinkStatus()
{
	var imgArr=[];
	var q=0;
	$('#markerLayer div img').each(function() {
		
		if($(this).attr('src').trim()!='resources/dashboard/Images/green_marker.png' && $(this).attr('src').trim()!='resources/dashboard/Images/school_icon.png' && $(this).attr('src').trim()!='resources/dashboard/Images/blue_marker.png')
		{
				if($(this).attr('src').trim()==studentArr[q])
				{
					if(typeof blinkArr[q] != 'undefined')
					{
						if(blinkArr[q]=='1')
						{
							console.log("YES");
							$(this).css('background-image','url(resources/dashboard/Images/marker-wimg_green.png)');	
						}else
						{
							console.log("NOT");
							$(this).css('background-image','url(resources/dashboard/Images/marker-wimg_yellow.png)');	
						}
						q++;
					}
				}
		}else{
			$(this).css('background-image','url(resources/dashboard/Images/marker-wimg.png)');	
		}
	});	
$(".map_info-win img").css('background-image','none');	
}
</script>
<style>
    html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
    }
    .map_div {
        border: 1px solid #CCCCCC;
        border-radius: 4px;
        float: left;
        height: 500px;
        margin-left: 4px;
        margin-top: 10px;
        padding: 10px;
        width: 700px;
    }
    .tb-speed1 span:nth-child(1) {
    font-size: 15px;
    display: block;
    font-weight: bold;
}

.tb-speed1 span:nth-child(2) {
    font-size: 15px;
}
.tb-speed1 {
    font-size: 16px;
    line-height: 29px;
    padding: 4px;
}
.tb-speed1 .checkbox {
    font-size: 14px;
    line-height: 22px;
}
</style>
<body onload="initialize();">
<div class="col-sm-7">
<p style="font-size: 17px;padding-left: 5px;">Map is showing your location of <span id="address_home">home</span> and <b>${route.source}</b> & <b>${route.destination}</b> for route <b>${route.route_name}</b></p>
<div class = 'map_div' style="width: 100%;">    

    <div id="map-canvas"></div>

</div>
</div>
<div class="col-sm-2">
	<div class="m-side">
			<div class="tb-speed1">
				<div class="checkbox">
					<input type="checkbox" id="fir_curitiba" checked="checked" onClick="toggleLayer('fir_curitiba')"> Show Geo Location
				</div>
			</div>
			
			<div class="tb-speed1"><span>Driver Login Time</span> 
			<span>
				<c:choose>
				<c:when test="${empty driver_login_date}">
					N/A
				</c:when>
				<c:otherwise>
					${driver_login_date}
				</c:otherwise>
				</c:choose>
			</span>
			
			</div>
			<div class="tb-speed"><span>Speed</span> <span id="speed_display">0</span> Km/h</div>
			<div class="tb-speed1"><span>Student Check-in Check-out time</span> </div>
			<div class="tb-speed1"><span>Stop Check-In</span> <span id="speed_display"><c:choose>
				<c:when test="${empty morning_time}">
					N/A
				</c:when>
				<c:otherwise>
					${morning_time}
				</c:otherwise>
				</c:choose>
				</span></div>
			<div class="tb-speed1"><span>School Check-Out</span> <span id="speed_display">
			<c:choose>
			<c:when test="${empty morning_logout}">
					N/A
				</c:when>
				<c:otherwise>
					 ${morning_logout} 
				</c:otherwise>
				</c:choose>
				</span></div>
			<div class="tb-speed1"><span>School Check-In</span> <span id="speed_display">
			<c:choose>
			<c:when test="${empty evening_login}">
					N/A
				</c:when>
				<c:otherwise>
					${evening_login}
				</c:otherwise>
				</c:choose></span></div>
			<div class="tb-speed1"><span>Stop Check-Out</span> <span id="speed_display">
			<c:choose>
			<c:when test="${empty evening_logout}">
					N/A
				</c:when>
				<c:otherwise>
					${evening_logout}
				</c:otherwise>
				</c:choose>
			</span></div>
	
					<!-- <div class="tb-speed"><span>Time to Arrive</span> <span>15</span> min</div> -->
	</div>
</div>


</body>
<script>

function getNewLatLng()
{
	$.ajax({
	    url : 'getDriverTrackLatLng.html',
	    type:'post',
	    data:{"s_route_id":"${route_id}"},
	    success : function(data) {
	    	var latiLongi = $.parseJSON(data);
			 //  calcRoute(latiLongi.lat_lng[0].lat, latiLongi.lat_lng[0].lng, latiLongi.lat_lng[1].lat, latiLongi.lat_lng[1].lng)
			    $("#speed_display").html(latiLongi.lat_lng[0].speed);
				var result = [latiLongi.lat_lng[0].lat, latiLongi.lat_lng[0].lng];
				transition(result);
				getStudentBlinkUpdatedStatus();
		  /* 	 clearMarkers();
			addRoute(latiLongi); */
	    }
	});
}
//Removes the markers from the map, but keeps them in the array.
function clearMarkers() {
  setAllMap(null);
 
}
function removeOverlay(locations) {
    
            clearMarkers();

} 
function setAllMap(map) {
  for (var i = 0; i < removeMarker.length; i++) {
    removeMarker[i].setMap(map);
  }
}
</script>
<input type="hidden" value="${size_l+1}" id="oTCount"> 
<input type="hidden" value="" id="tTCount"> 
<script type="text/javascript">
$(document).ready(function(){
   
setInterval(
        function ()
        {
            $.post('trackSingleRouteCount.html',{'s_route_id':"${route_id}"},function(data) {
               var data = $.parseJSON(data);
               $("#tTCount").val(data.size_l);
            });
            var old_count=$("#oTCount").val();
            var new_count=$("#tTCount").val();
            if(parseInt(new_count) > parseInt(old_count))
            {
            	getNewLatLng();
               $("#oTCount").val(new_count);

            }
           
        }, 2000); 
/*
    window.setInterval(function(){
    getRoute();
}, 5000);*/


});
</script>
</div>
<script type="text/javascript">
  function getPolygonCoords() {
    var len = myPolygon.getPath().getLength();
    var htmlStr = "";
    for (var i = 0; i < len; i++) {
      if(i<len-1)
        {
        htmlStr += myPolygon.getPath().getAt(i).toUrlValue(5) + ":";
        }
      else
        {
        htmlStr += myPolygon.getPath().getAt(i).toUrlValue(5) ;
        }
      
      
    }
    $("#radius").val(htmlStr);
  }
  function copyToClipboard(text) {
    window.prompt("Copy to clipboard: Ctrl+C, Enter", text);
  }
  $(document).ready(function(){
	 // setTimeout(function(){ calcRoute("${first_lat_lng[0].lat}","${first_lat_lng[0].lng}","${first_lat_lng[1].lat}","${first_lat_lng[1].lng}");}, 3000);
		
	});
  
  function toggleLayer(id)
  {
	  if ($('#'+id).is(':checked')) {
    	  myPolygon.setMap(map);
      }
      else
      {
    	  myPolygon.setMap(null);
      }
  }
  
  //Javascript function for get student latest updated blink status
  function getStudentBlinkUpdatedStatus()
  {     
		  $.ajax({
		    url : 'getStudentBlinkUpdatedStatus.html',
		    type:'post',
		    data:{"route_id":"${route_id}"},
		    success : function(data) {
		    	blinkArr=[];
		    	var latiLongi = $.parseJSON(data);
		    	for(var u=0;u<latiLongi.latlong.length;u++)
		    	{
		    		console.log(latiLongi.latlong[u].blink_s);
		    		blinkArr.push(latiLongi.latlong[u].blink_s);
		    		changeBlinkStatus();
		    	}
		    //	blinkArr.push("${latlng.blink_s}");
		    //	console.log(latiLongi.latlong);	
		    }
		});
  }
 
</script>

<jsp:include page="footer.jsp" />